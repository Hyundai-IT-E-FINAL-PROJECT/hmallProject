<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.team2.mapper.OrderMapper">
    <select id="readOne" resultType="org.team2.domain.OrderVO">
        select * from tbl_order where order_seq=#{seq}
    </select>


    <update id="updateOrder">
        update tbl_order
        set order_point=#{point},
            order_status=#{status},
            order_user_number=#{userNumber},
            order_delivery=#{delivery},
            order_invoice=#{invoice},
            updated_at=sysdate
        where order_seq=#{seq}
    </update>

    <delete id="deleteOne">
        delete from tbl_order where order_seq=#{seq}
    </delete>

    <select id="packageSelect">
        declare p_cursor sys_refcursor;
            order_rec tbl_order%rowtype;
                    begin
            pack_order.proc_order_select_all(p_cursor);
            loop
                    fetch p_cursor into order_rec;
              exit when p_cursor%notfound;
                    end loop;
                    close p_cursor;
                    end;

    </select>

<!--    op_seq값 반환-->
    <insert id="insert" parameterType="org.team2.domain.OrderVO">

        INSERT INTO tbl_order(
            order_seq,
            user_seq,
            order_point,
            order_status,
            order_user_name,
            order_user_number,
            order_delivery,
            order_invoice,
            order_total_cost,
            order_message,
            created_at,
            updated_at
        ) values(
            #{no},
            #{OrderVO.user_seq},
            #{OrderVO.point},
            #{OrderVO.status},
            #{OrderVO.userName},
            #{OrderVO.userNumber},
            #{OrderVO.delivery},
            #{OrderVO.invoice},
            #{OrderVO.totalCost},
            #{OrderVO.message},
            sysdate,
            sysdate
        )

        <selectKey keyProperty="no" resultType="long" order="BEFORE">
            select seq_order.nextval from dual
        </selectKey>



    </insert>

    <insert id="insertOp">

        <selectKey keyProperty="op_seq" resultType="int" order="BEFORE">
            select seq_op.nextval from dual
        </selectKey>

        insert into tbl_op(op_seq,order_seq, product_seq, op_count)
        values(#{op_seq}, #{OpVO.order_seq}, #{ProductVO.product_seq}, 1)
    </insert>

    <delete id="delete" statementType="CALLABLE">
        {
            call pack_order.proc_order_delete(#{order_seq})
        }
    </delete>

    <resultMap id="orderMap" type="org.team2.domain.OrderVO">
        <result property="order_seq" column="order_seq" />
    </resultMap>



</mapper>